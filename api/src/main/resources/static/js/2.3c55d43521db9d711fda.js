webpackJsonp([2],{"9bBU":function(t,e,n){n("mClu");var o=n("FeBl").Object;t.exports=function(t,e,n){return o.defineProperty(t,e,n)}},C4MV:function(t,e,n){t.exports={default:n("9bBU"),__esModule:!0}},Jxlu:function(t,e,n){"use strict";var o={props:{loading:{type:Boolean,default:!1},selectable:Boolean,userList:{type:Array}},methods:{onSelectChange:function(t,e){this.$emit("select",t,e)}}},a={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"user-table",attrs:{data:t.userList},on:{select:t.onSelectChange}},[t.selectable?n("el-table-column",{attrs:{selectable:!0}}):t._e(),t._v(" "),n("el-table-column",{attrs:{label:"头像",width:"120"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[n("el-image",{staticClass:"headImg",attrs:{fit:"cover",src:e.headImg}})]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"昵称",width:"120"}}),t._v(" "),n("el-table-column",{attrs:{prop:"sex",label:"性别",width:"80"}}),t._v(" "),n("el-table-column",{attrs:{prop:"phone",label:"手机号",width:"240"}}),t._v(" "),n("el-table-column",{attrs:{label:"用户标签","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return t._l(o.tags,function(e){return n("el-tag",{key:e.id,staticStyle:{margin:"5px"}},[t._v("\n          "+t._s(e.name)+"\n        ")])})}}])}),t._v(" "),n("el-table-column",{attrs:{label:"订阅时间",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[n("i",{staticClass:"el-icon-time"}),t._v(" "),n("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t._f("formatTimeInMillis")(o.subscribeTime)))])]}}])}),t._v(" "),t._t("tail")],2)],1)},staticRenderFns:[]};var i=n("VU/8")(o,a,!1,function(t){n("O2kQ")},"data-v-12d9e60d",null);e.a=i.exports},Kh5d:function(t,e,n){var o=n("sB3e"),a=n("PzxK");n("uqUo")("getPrototypeOf",function(){return function(t){return a(o(t))}})},"MU+D":function(t,e){},O2kQ:function(t,e){},OvRC:function(t,e,n){t.exports={default:n("oM7Q"),__esModule:!0}},Pf15:function(t,e,n){"use strict";e.__esModule=!0;var o=s(n("kiBT")),a=s(n("OvRC")),i=s(n("pFYg"));function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,i.default)(e)));t.prototype=(0,a.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(o.default?(0,o.default)(t,e):t.__proto__=e)}},RhWW:function(t,e,n){"use strict";var o=n("Zrlr"),a=n.n(o);e.a=function t(e){a()(this,t),this.context=e,this.$common=e.$common}},ZaQb:function(t,e,n){var o=n("EqjI"),a=n("77Pl"),i=function(t,e){if(a(t),!o(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,o){try{(o=n("+ZMJ")(Function.call,n("LKZe").f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return i(t,n),e?t.__proto__=n:o(t,n),t}}({},!1):void 0),check:i}},Zrlr:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},Zx67:function(t,e,n){t.exports={default:n("fS6E"),__esModule:!0}},exh5:function(t,e,n){var o=n("kM2E");o(o.S,"Object",{setPrototypeOf:n("ZaQb").set})},fS6E:function(t,e,n){n("Kh5d"),t.exports=n("FeBl").Object.getPrototypeOf},"h40+":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("Jxlu"),a=n("XF1/"),i=n("Zx67"),s=n.n(i),l=n("Zrlr"),c=n.n(l),r=n("wxAW"),u=n.n(r),d=n("zwoO"),f=n.n(d),g=n("Pf15"),h=n.n(g),p=n("RhWW"),m=n("gyMJ"),v=function(t){function e(t){c()(this,e);var n=f()(this,(e.__proto__||s()(e)).call(this,t));return n.$common=n.context.$common,n}return h()(e,t),u()(e,[{key:"loadUsers",value:function(){var t=this;this.$common.showLoading(),this.netLoadUsers(function(){t.$common.hideLoading()})}},{key:"netLoadUsers",value:function(t){var e=this;m.a.push.loadUserList([this.context.curTagId],this.context.curPage,this.context.pageSize,this.context.searchKey).commonThen(function(t,n){e.context.total=n.total,e.context.userList=n.data},this.context).finally(function(){t&&t()})}},{key:"addTag",value:function(t){var e=this;this.$common.showLoading(),m.a.tag.addTag(t).commonThen(function(t,n){e.context.tagList.splice(0,0,n)},this.context).finally(function(){e.$common.hideLoading()})}},{key:"deleteTag",value:function(t,e){var n=this;this.$common.showLoading(),m.a.tag.deleteTag(t).commonThen(function(t,o){n.context.tagList.splice(e,1)},this.context).finally(function(){n.$common.hideLoading()})}},{key:"updateTag",value:function(t,e,n){var o=this;this.$common.showLoading(),m.a.tag.updateTag(t,e).commonThen(function(e,a){o.context.tagList[n].name=t},this.context).finally(function(){o.$common.hideLoading()})}},{key:"init",value:function(){var t=this;m.a.tag.getTagListWithCount().commonThen(function(e,n){t.context.tagList=n,t.netLoadUsers(function(){t.$common.hideLoading()})},this.context).catch(function(){t.$common.hideLoading()})}},{key:"addUserTag",value:function(){var t=this;this.context.curUser.tags.some(function(e){return e.id===t.context.toAddTagId})?this.context.$message.error("该用户已有此标签"):(this.$common.showLoading(),m.a.tag.addTagToUser(this.context.curUser.id,this.context.toAddTagId).commonThen(function(e,n){t.context.$message("添加成功"),t.context.addTagVisible=!1,t.init()}).finally(function(){t.$common.hideLoading()}))}},{key:"deleteTagOfUser",value:function(t){var e=this;this.$common.showLoading(),m.a.tag.deleteTagOfUser(t).commonThen(function(t,n){e.context.$message("删除成功"),e.init(),e.context.allTagVisible=!1}).finally(function(){e.$common.hideLoading()})}}]),e}(p.a),_={data:function(){return{searchKey:"",userLoading:!1,uploadVisible:!1,uploadData:{action:this.api.baseURL+"/tag/user/list",modelAction:this.api.baseURL+"/resource/template/tag"},userList:[],total:0,curPage:1,pageSize:20,curTagId:null,tagList:[],tagBusiness:new v(this),addTagVisible:!1,toAddTagId:null,curUser:{tags:[]},allTagVisible:!1}},mounted:function(){this.tagBusiness.init()},computed:{userCount:function(){return 9561}},methods:{onPageChange:function(t){this.curPage=t,this.tagBusiness.loadUsers()},onSizeChange:function(t){this.pageSize=t,this.tagBusiness.loadUsers()},onTagSelect:function(t){this.curTagId=t,console.log("...."),this.tagBusiness.loadUsers()},onSearch:function(){this.tagBusiness.loadUsers()},onAddTag:function(){var t=this;this.$prompt("请输入标签名","新建标签",{confirmButtonText:"添加",cancelButtonText:"取消"}).then(function(e){var n=e.value;t.$common.showLoading(),t.tagBusiness.addTag(n)})},onEditTag:function(t,e){var n=this;this.$prompt("请输入标签名","修改标签",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.name}).then(function(o){var a=o.value;n.tagBusiness.updateTag(a,t.id,e)})},onUploadSuccess:function(){this.tagBusiness.loadUsers()},onDeleteTag:function(t,e){var n=this;this.$confirm("确认删除标签吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){n.$common.showLoading(),n.tagBusiness.deleteTag(t,e)})},onAddUserTag:function(t){this.addTagVisible=!0,this.curUser=t},onShowAllTag:function(t){this.curUser=t,this.allTagVisible=!0},onConfirmAddTag:function(){this.tagBusiness.addUserTag()},onDeleteTagOfUser:function(t){this.tagBusiness.deleteTagOfUser(t)}},components:{Upload:n("jd+X").a,BottomButtonDialog:a.a,UserTable:o.a}},b={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tags"},[n("el-row",[n("el-col",{attrs:{span:6,push:2}},[n("el-input",{attrs:{placeholder:"用户昵称或电话,回车搜索"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch(e)}},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),t._v(" "),n("el-col",{attrs:{span:4,push:8}},[null!==t.curTagId?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.uploadVisible=!0}}},[t._v("导入到当前标签")]):t._e()],1),t._v(" "),n("el-col",{attrs:{span:3,push:11,align:"right"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.onAddTag}},[n("q",{staticClass:"el-icon-plus"}),t._v("新建标签")])],1)],1),t._v(" "),n("el-row",{staticStyle:{"margin-top":"20px"}},[n("el-col",{attrs:{push:2,span:16}},[n("user-table",{attrs:{"user-list":t.userList,loading:t.userLoading}},[n("template",{slot:"tail"},[n("el-table-column",{attrs:{width:"200px",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onAddUserTag(o)}}},[t._v("添加标签")]),t._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.onShowAllTag(o)}}},[t._v("所有标签")])]}}])})],1)],2),t._v(" "),n("el-pagination",{attrs:{total:t.total,"current-page":t.curPage,"page-size":t.pageSize,layout:"sizes, prev, pager, next"},on:{"current-change":t.onPageChange,"size-change":t.onSizeChange}})],1),t._v(" "),n("el-col",{attrs:{span:5,push:3}},[n("div",{staticClass:"tag-list-wrap"},[n("div",{staticClass:"font-sm tag-header"},[t._v("全部标签("+t._s(t.tagList.length)+")")]),t._v(" "),n("div",{staticClass:"tag-item font-sm",on:{click:function(e){return t.onTagSelect(null)}}},[n("q",{staticClass:"el-icon-check active-icon",class:{active:null===t.curTagId}}),t._v(" "),n("span",{staticClass:"tag-name"},[t._v(" 全部用户 ")])]),t._v(" "),t._l(t.tagList,function(e,o){return n("div",{key:e.id,staticClass:"tag-item font-sm",on:{click:function(n){return t.onTagSelect(e.id)}}},[n("q",{staticClass:"el-icon-check active-icon",class:{active:e.id===t.curTagId}}),t._v(" "),n("span",{staticClass:"tag-name",on:{click:function(n){return n.stopPropagation(),t.onEditTag(e,o)}}},[t._v(" "+t._s(e.name)+" ("+t._s(e.count)+")")]),t._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.id!==t.curTagId,expression:"tag.id !== curTagId"}],attrs:{size:"mini",type:"text"},on:{click:function(n){return n.stopPropagation(),t.onDeleteTag(e.id,o)}}},[n("q",{staticClass:"el-icon-delete"})])],1)})],2)])],1),t._v(" "),n("bottom-button-dialog",{attrs:{"bottom-visible":!1,visible:t.uploadVisible,title:"添加标签用户"},on:{"update:visible":function(e){t.uploadVisible=e}}},[[n("upload",{attrs:{action:t.uploadData.action,"model-action":t.uploadData.modelAction,data:{tagId:t.curTagId},"on-success":t.onUploadSuccess}})]],2),t._v(" "),n("bottom-button-dialog",{attrs:{visible:t.addTagVisible,title:"添加标签",width:"30%"},on:{"update:visible":function(e){t.addTagVisible=e},"on-confirm":t.onConfirmAddTag}},[n("div",{attrs:{align:"center"}},[n("el-select",{model:{value:t.toAddTagId,callback:function(e){t.toAddTagId=e},expression:"toAddTagId"}},t._l(t.tagList,function(t){return n("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})}),1)],1)]),t._v(" "),n("bottom-button-dialog",{attrs:{visible:t.allTagVisible,title:"所有标签",width:"30%","bottom-visible":!1},on:{"update:visible":function(e){t.allTagVisible=e}}},[n("div",{attrs:{align:"center"}},t._l(t.curUser.tags,function(e){return n("el-tag",{key:e.id,staticStyle:{margin:"5px"}},[t._v("\n        "+t._s(e.name)+"  "),n("q",{staticClass:"el-icon-delete",on:{click:function(n){return t.onDeleteTagOfUser(e.userTagId)}}})])}),1)])],1)},staticRenderFns:[]};var T=n("VU/8")(_,b,!1,function(t){n("MU+D")},"data-v-dfb57776",null);e.default=T.exports},"i/C/":function(t,e,n){n("exh5"),t.exports=n("FeBl").Object.setPrototypeOf},kiBT:function(t,e,n){t.exports={default:n("i/C/"),__esModule:!0}},mClu:function(t,e,n){var o=n("kM2E");o(o.S+o.F*!n("+E39"),"Object",{defineProperty:n("evD5").f})},oM7Q:function(t,e,n){n("sF+V");var o=n("FeBl").Object;t.exports=function(t,e){return o.create(t,e)}},"sF+V":function(t,e,n){var o=n("kM2E");o(o.S,"Object",{create:n("Yobk")})},wxAW:function(t,e,n){"use strict";e.__esModule=!0;var o,a=n("C4MV"),i=(o=a)&&o.__esModule?o:{default:o};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,i.default)(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}()},zwoO:function(t,e,n){"use strict";e.__esModule=!0;var o,a=n("pFYg"),i=(o=a)&&o.__esModule?o:{default:o};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,i.default)(e))&&"function"!=typeof e?t:e}}});
//# sourceMappingURL=2.3c55d43521db9d711fda.js.map