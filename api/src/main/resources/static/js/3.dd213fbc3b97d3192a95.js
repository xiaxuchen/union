webpackJsonp([3],{"6Dxo":function(e,t){},"8BoE":function(e,t){},"I9/8":function(e,t){},L2M8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),i=a.n(s),n=a("fZjL"),r=a.n(n),o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"search-bar"},[a("el-form",{attrs:{inline:!0,model:e.filters}},[a("el-form-item",[e._v("\n      姓名  ： "),a("el-input",{staticStyle:{width:"200px",heght:"30px"},attrs:{placeholder:"姓名",size:"mini"},model:{value:e.filters.name,callback:function(t){e.$set(e.filters,"name",t)},expression:"filters.name"}})],1),e._v(" "),a("el-form-item",[e._v("\n      编码 ："),a("el-input",{staticStyle:{width:"200px",heght:"30px"},attrs:{placeholder:"编码",size:"mini"},model:{value:e.filters.userId,callback:function(t){e.$set(e.filters,"userId",t)},expression:"filters.userId"}})],1),e._v(" "),a("el-form-item",[e._v("\n      角色 ：\n      "),a("el-select",{attrs:{placeholder:"请选择",clearable:"",size:"mini"},model:{value:e.filters.roleId,callback:function(t){e.$set(e.filters,"roleId",t)},expression:"filters.roleId"}},e._l(e.roleOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",[e._v("\n      用户名："),a("el-input",{staticStyle:{width:"200px",heght:"30px"},attrs:{placeholder:"用户名",size:"mini"},model:{value:e.filters.userName,callback:function(t){e.$set(e.filters,"userName",t)},expression:"filters.userName"}})],1),e._v(" "),a("el-form-item",[e._v("\n      手机："),a("el-input",{staticStyle:{width:"200px",heght:"30px"},attrs:{placeholder:"手机",size:"mini"},model:{value:e.filters.mobile,callback:function(t){e.$set(e.filters,"mobile",t)},expression:"filters.mobile"}})],1),e._v(" "),a("el-form-item",[e._v("\n      性别：\n      "),a("el-select",{attrs:{placeholder:"请选择",clearable:"",size:"mini"},model:{value:e.filters.sex,callback:function(t){e.$set(e.filters,"sex",t)},expression:"filters.sex"}},e._l(e.sexOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.searchClick}},[e._v("搜索")])],1)],1)],1)},staticRenderFns:[]};var l=a("VU/8")({mounted:function(){var e=this;this.api.sysuser.getSysRoles().then(this.api.commonResp(function(t,a){t&&(e.roleOptions=a)}))},data:function(){return{filters:{name:"",userName:"",userId:"",mobile:"",sex:"",roleId:null},roleOptions:[],sexOptions:[{value:"1",label:"男"},{value:"2",label:"女"}]}},methods:{searchClick:function(){this.$emit("search",this.filters)}}},o,!1,function(e){a("Xh5J")},"data-v-40812c08",null).exports,d=a("woOf"),u=a.n(d),m=a("mvHQ"),c=a.n(m),f=a("XF1/"),p=a("wA58"),g={username:"",password:"",phone:"",sex:0,isAgent:!1,isInvalid:!1,headImg:"",agentInfo:{name:"",des:""}},h={components:{BottomButtonDialog:f.a,UploadImage:p.a},data:function(){return{editForm:g,visible:!1,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:20,message:"长度在 5 到 20 个字符",trigger:"blur"}]}}},mounted:function(){var e=this;this.$bus.$on("change-edit-sys-dialog",function(t,a){if(console.log(c()(a)),t){var s=i()({},a);s.isInvalid=0===s.state,s.isAgent=!!a.roles&&a.roles.some(function(e){return 2===e.id}),s.isAgent||(s.agentInfo={}),e.editForm=s}e.visible=t})},methods:{onImageChange:function(e){console.log(e),this.editForm=u()({},this.editForm,{headImg:e})},saveUser:function(){var e=this;this.$refs.editForm.validate(function(t){if(!t)return e.$message.error("请按要求填写用户信息"),!1;e.visible=!1;var a={userId:e.editForm.userId,username:e.editForm.username,isAgent:e.editForm.isAgent,isInvalid:e.editForm.isInvalid,headImg:e.editForm.headImg};if(e.editForm.phone&&(a.phone=e.editForm.phone),e.editForm.password){if(!(e.editForm.password.length>=5&&e.editForm.password.length<=20))return void e.$message.error("密码的长度必须为5-20之间");a.password=e.editForm.password}if(e.editForm.isAgent){var s=i()({},e.editForm.agentInfo);s.agentId=s.id,delete s.id,r()(s).forEach(function(e){a[e]=s[e]})}e.$emit("save-user",a)})},validateName:function(e,t,a){this.editForm.isAgent&&""===t?a(new Error("请输入姓名")):a()},validateAccount:function(e,t,a){this.editForm.isAgent&&""===t?a(new Error("请填写绑定的客服账号")):a()}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("bottom-button-dialog",{attrs:{title:"编辑用户","confirm-button":"保存",visible:e.visible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t},"on-confirm":e.saveUser}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.rules,"label-width":"100px"}},[a("el-row",{staticStyle:{"margin-left":"-10px"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"登录名",prop:"username"}},[a("el-input",{model:{value:e.editForm.username,callback:function(t){e.$set(e.editForm,"username",t)},expression:"editForm.username"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"登录密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"可修改,但无法查看"},model:{value:e.editForm.password,callback:function(t){e.$set(e.editForm,"password",t)},expression:"editForm.password"}})],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-left":"-10px"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"电话"}},[a("el-input",{model:{value:e.editForm.phone,callback:function(t){e.$set(e.editForm,"phone",t)},expression:"editForm.phone"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"头像"}},[a("upload-image",{attrs:{"cur-image":e.editForm.headImg},on:{"on-image-change":e.onImageChange}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否禁用"}},[a("el-switch",{model:{value:e.editForm.isInvalid,callback:function(t){e.$set(e.editForm,"isInvalid",t)},expression:"editForm.isInvalid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户经理"}},[a("el-switch",{model:{value:e.editForm.isAgent,callback:function(t){e.$set(e.editForm,"isAgent",t)},expression:"editForm.isAgent"}})],1),e._v(" "),e.editForm.isAgent?[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{model:{value:e.editForm.agentInfo.name,callback:function(t){e.$set(e.editForm.agentInfo,"name",t)},expression:"editForm.agentInfo.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"性别"}},[a("el-select",{attrs:{placeholder:"请选择性别"},model:{value:e.editForm.agentInfo.sex,callback:function(t){e.$set(e.editForm.agentInfo,"sex",t)},expression:"editForm.agentInfo.sex"}},[a("el-option",{attrs:{label:"未知",value:0}}),e._v(" "),a("el-option",{attrs:{label:"男",value:1}}),e._v(" "),a("el-option",{attrs:{label:"女",value:2}})],1)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"自我简介",prop:"des"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.editForm.agentInfo.des,callback:function(t){e.$set(e.editForm.agentInfo,"des",t)},expression:"editForm.agentInfo.des"}})],1)]:e._e()],2)],1)],1)},staticRenderFns:[]};var b=a("VU/8")(h,v,!1,function(e){a("xdks")},"data-v-a39c0088",null).exports,F={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"查看角色",visible:e.visible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"infoForm",attrs:{model:e.infoForm,"label-width":"80px",inline:!0}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0},model:{value:e.infoForm.username,callback:function(t){e.$set(e.infoForm,"username",t)},expression:"infoForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"编码",prop:"userId"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0},model:{value:e.infoForm.userId,callback:function(t){e.$set(e.infoForm,"userId",t)},expression:"infoForm.userId"}})],1)],1),e._v(" "),a("el-form",{attrs:{"label-width":"80px",inline:!0}},e._l(e.infoForm.roles,function(t){return a("div",{key:t.id},[a("el-form-item",{attrs:{label:"角色名称"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色编码"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0},model:{value:t.id,callback:function(a){e.$set(t,"id",a)},expression:"item.id"}})],1)],1)}),0),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var _=a("VU/8")({mounted:function(){var e=this;this.$bus.$on("change-role-dialog",function(t,a){e.infoForm=a,e.visible=t})},data:function(){return{visible:!1,infoForm:{}}}},F,!1,function(e){a("I9/8")},"data-v-2494fbdd",null).exports,$=a("cH51"),x={components:{HeadImage:$.a,EditSysUserDialog:b,ShowRoleDialog:_},props:{sysuserList:{type:Array,required:!0},listLoading:{type:Boolean,required:!0}},methods:{isUserAble:function(e){return!(e.roles&&e.roles.some(function(e){return 2===e.id}))},handleRelation:function(e){this.$router.push("/relation/"+e.userId)},selectChange:function(e){this.$emit("select-change",e.map(function(e){return e.userId}))},formatSex:function(e,t){return 1===e.sex?"男":0===e.sex?"女":"未知"},formatState:function(e,t){return 1===e.state?"正常":"禁用"},handleEdit:function(e,t){this.$bus.$emit("change-edit-sys-dialog",!0,t)},handleRole:function(e,t){this.$bus.$emit("change-role-dialog",!0,t)},onSaveUser:function(e){this.$emit("update-user",e)}}},I={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"manager-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"el-tb-edit mgt20",attrs:{data:e.sysuserList,size:"mini","highlight-current-row":"",border:""},on:{"selection-change":e.selectChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userId",label:"编号"}}),e._v(" "),a("el-table-column",{attrs:{label:"头像"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("head-image",{staticClass:"head-img",attrs:{url:t.headImg}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"}},[e._v(e._s(t.row.username))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"agentInfo.sex",label:"性别",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.agentInfo?a("span",[e._v("\n            "+e._s(e._f("formatSex")(s.agentInfo.sex))+"\n          ")]):a("span",[e._v("\n            未知\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"state",label:"是否有效",formatter:e.formatState,sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"el-icon-time"}),e._v(" "),a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e._f("formatTimeInMillis")(t.row.createTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(a){return e.handleRole(t.$index,t.row)}}},[e._v("角色")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.isUserAble(t.row),plain:"",size:"small"},on:{click:function(a){return e.handleRelation(t.row)}}},[e._v("用户")])]}}])})],1),e._v(" "),a("edit-sys-user-dialog",{on:{"save-user":e.onSaveUser}}),e._v(" "),a("show-role-dialog")],1)},staticRenderFns:[]};var y=a("VU/8")(x,I,!1,function(e){a("6Dxo")},"data-v-f4e5c692",null).exports,w={username:"",password:"",isAgent:!1,name:"",sex:null,phone:"",des:"",headImg:""},k={components:{HeadImage:$.a,BottomButtonDialog:f.a,UploadImage:p.a},data:function(){return{addForm:i()({},w),headImgUrl:"",visible:!1,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:20,message:"长度在 5 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,max:20,message:"长度在 5 到 20 个字符",trigger:"blur"}]}}},mounted:function(){var e=this;this.$bus.$on("change-add-sys-dialog",function(t){e.addForm=i()({},w),e.visible=t})},methods:{onImageChange:function(e){this.addForm.headImg=e,this.headImgUrl=e},addUser:function(){var e=this;this.$refs.addForm.validate(function(t){return t?null==e.headImgUrl?(e.$message.error("请上传用户头像"),!0):void e.$emit("add-user",e.addForm):(e.$message.error("请按要求填写用户信息"),!1)})},validateName:function(e,t,a){this.addForm.isAgent&&""===t?a(new Error("请输入姓名")):a()},validateAccount:function(e,t,a){this.addForm.isAgent&&""===t?a(new Error("请填写绑定的客服账号")):a()}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("bottom-button-dialog",{attrs:{title:"新增用户",visible:e.visible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t},"on-confirm":e.addUser}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules,"label-width":"100px"}},[a("el-row",{staticStyle:{"margin-left":"-10px"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"登录名",prop:"username"}},[a("el-input",{model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"登录密码",prop:"password"}},[a("el-input",{model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}})],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-left":"-10px"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"电话"}},[a("el-input",{model:{value:e.addForm.phone,callback:function(t){e.$set(e.addForm,"phone",t)},expression:"addForm.phone"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"头像"}},[a("upload-image",{attrs:{"cur-image":e.addForm.headImg},on:{"on-image-change":e.onImageChange}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户经理"}},[a("el-switch",{model:{value:e.addForm.isAgent,callback:function(t){e.$set(e.addForm,"isAgent",t)},expression:"addForm.isAgent"}})],1),e._v(" "),e.addForm.isAgent?[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"性别"}},[a("el-select",{attrs:{placeholder:"请选择性别"},model:{value:e.addForm.sex,callback:function(t){e.$set(e.addForm,"sex",t)},expression:"addForm.sex"}},[a("el-option",{attrs:{label:"未知",value:0}}),e._v(" "),a("el-option",{attrs:{label:"男",value:1}}),e._v(" "),a("el-option",{attrs:{label:"女",value:2}})],1)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"自我简介",prop:"des"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.addForm.des,callback:function(t){e.$set(e.addForm,"des",t)},expression:"addForm.des"}})],1)]:e._e()],2)],1)],1)},staticRenderFns:[]};var U={mounted:function(){var e=this;this.loadUserList(),this.$bus.$on("on-user-list-update",function(){e.loadUserList()})},components:{SearchBar:l,ManagerTable:y,AddSysUserDialog:a("VU/8")(k,S,!1,function(e){a("SEeh")},"data-v-0d4042de",null).exports},data:function(){return{sysuserList:[],listLoading:!1,selectedUserIds:[],total:0,currentPage:1,pageSize:10,filter:{}}},methods:{onAddUser:function(e){var t=this;this.$bus.$emit("show-loading-dialog"),this.api.sysuser.addSysuser(e).then(this.api.commonResp(function(e,a){e?(t.$message("添加成功"),t.$bus.$emit("change-add-sys-dialog",!1),t.$bus.$emit("on-user-list-update")):t.$message.error("添加失败:"+a)})).finally(function(){t.$bus.$emit("hide-loading-dialog")})},onUpdateUser:function(e){var t=this;this.api.sysuser.updateUser(e).then(this.api.commonResp(function(e,a){e?(t.$message("保存成功"),t.$bus.$emit("change-edit-sys-dialog",!1),t.$bus.$emit("on-user-list-update"),t.$store.dispatch("manager/refresh")):t.$message.error("保存失败:"+a)})).finally(function(){t.$bus.$emit("hide-loading-dialog")})},onSearch:function(e){var t=this;this.filter={},r()(e).forEach(function(a){var s=e[a];s&&(t.filter[a]=s)}),this.loadUserList()},onPageChange:function(e){this.curPage=e,this.loadUserList()},onSizeChange:function(e){this.pageSize=e,this.loadUserList()},deleteSelectedManagers:function(){var e=this;0!==this.selectedUserIds.length?this.$confirm("此操作将永久删除这些用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.deleteManagers(e.selectedUserIds)}):this.$message.error("您还没有选择待删除的用户")},deleteManagers:function(e){var t=this;this.$bus.$emit("show-loading-dialog");var a=e.reduce(function(e,t){return""===e?t+"":e+","+t},"");this.api.sysuser.deleteSysuser(a).then(this.api.commonResp(function(e,a){e?(t.$message("删除成功"),t.loadUserList()):t.$message.error("删除失败:"+a)})).finally(function(){t.$bus.$emit("hide-loading-dialog")})},addManager:function(){this.$bus.$emit("change-add-sys-dialog",!0)},onManagerSelectChange:function(e){console.log(e),this.selectedUserIds=e},loadUserList:function(){var e=this;this.listLoading=!0,this.api.sysuser.getSysUserList(i()({curPage:this.curPage,pageSize:this.pageSize},this.filter)).then(this.api.commonResp(function(t,a){t?(e.sysuserList=a.data,e.total=a.total):e.$message.error(a)})).finally(function(){e.listLoading=!1})}}},A={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sys-user"},[a("search-bar",{on:{search:e.onSearch}}),e._v(" "),a("div",{staticStyle:{padding:"20px 0"}},[a("el-button",{attrs:{type:"success",icon:"el-icon-circle-plus-outline",size:"mini",round:""},on:{click:e.addManager}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",round:""},on:{click:e.deleteSelectedManagers}},[e._v("删除")])],1),e._v(" "),a("manager-table",{attrs:{"sysuser-list":e.sysuserList,"list-loading":e.listLoading},on:{"select-change":e.onManagerSelectChange,"update-user":e.onUpdateUser}}),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"sizes, prev, pager, next, jumper, total",total:e.total},on:{"size-change":e.onSizeChange,"current-change":e.onPageChange}})],1),e._v(" "),a("add-sys-user-dialog",{on:{"add-user":e.onAddUser}})],1)},staticRenderFns:[]};var z=a("VU/8")(U,A,!1,function(e){a("TEwh")},"data-v-13f55ac0",null);t.default=z.exports},SEeh:function(e,t){},TEwh:function(e,t){},Xh5J:function(e,t){},wA58:function(e,t,a){"use strict";var s={components:{HeadImage:a("cH51").a},data:function(){return{headers:{Authorization:this.$store.state.manager.token}}},props:{curImage:{type:String,default:""}},methods:{handleAvatarSuccess:function(e){var t=e;t.success&&this.$emit("on-image-change",t.data)}}},i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-upload",{staticClass:"avatar-uploader",attrs:{"show-file-list":!1,action:this.api.baseURL+"/resource/file","on-success":this.handleAvatarSuccess,headers:this.headers}},[this.curImage?t("head-image",{staticClass:"avatar",attrs:{url:this.curImage}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1)],1)},staticRenderFns:[]};var n=a("VU/8")(s,i,!1,function(e){a("8BoE")},"data-v-ac550fee",null);t.a=n.exports},xdks:function(e,t){}});
//# sourceMappingURL=3.dd213fbc3b97d3192a95.js.map